<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!--
    <meta name='viewport' content='width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;' />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    -->

    <title>Foosball</title>
    
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.0b3/jquery.mobile-1.0b3.min.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.6.3.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/mobile/1.0b3/jquery.mobile-1.0b3.min.js"></script>
    
    <style type="text/css">
        .hidden {
            display:none;
        }
    </style>
</head>
<body>



<div id="pageListGames" data-role="page"> 
    <div data-role="header" data-position="inline">
        <h1>Game List</h1>
    </div>
    
    <div data-role="content">
        <ul id="gameList" data-role="listview" data-theme="c"></ul>
    </div>
    
    <div data-role="footer" data-id="myFooter" data-position="fixed" class="ui-bar">
        <a href="#pageListGames" data-role="button" data-icon="grid" class="ui-btn-active ui-state-persist">Games</a>
        <a href="#pageListPlayers" data-role="button" data-icon="grid">Players</a>
        <a href="#" data-role="button" data-icon="plus" onclick="Foosball.DOMHelper.addGame(); return false;">Game</a>
        <a href="#" data-role="button" data-icon="plus" onclick="Foosball.DOMHelper.addPlayer(); return false;">Player</a>
    </div>
</div>

<div id="pageListPlayers" data-role="page"> 
    <div data-role="header" data-position="inline">
        <h1>Player List</h1>
    </div>
    
    <div data-role="content">
        <ul id="playerList" data-role="listview" data-filter="true" data-theme="c"></ul>
    </div>
    
    <div data-role="footer" data-id="myFooter" data-position="fixed" class="ui-bar">
        <a href="#pageListGames" data-role="button" data-icon="grid">Games</a>
        <a href="#pageListPlayers" data-role="button" data-icon="grid" class="ui-btn-active ui-state-persist">Players</a>
        <a href="#" data-role="button" data-icon="plus" onclick="Foosball.DOMHelper.addGame(); return false;">Game</a>
        <a href="#" data-role="button" data-icon="plus" onclick="Foosball.DOMHelper.addPlayer(); return false;">Player</a>
    </div>
</div>



<div id="pagePlayerSettings" data-role="page">
    <div data-role="header" data-position="inline">
        <h1 id="pagePlayerSettings_Title"></h1>
    </div>
    <div data-role="content">
        <input type="hidden" name="pagePlayerSettings_Id" id="pagePlayerSettings_Id" />
        <div data-role="fieldcontain">
            <label for="pagePlayerSettings_Name">Player Name:</label>
            <input type="text" name="pagePlayerSettings_Name" id="pagePlayerSettings_Name" />
        </div>	
        <fieldset class="ui-grid-a">
            <div class="ui-block-a"><input type="button" value="Cancel" onclick="$.mobile.changePage('#pageListPlayers');" /></div>
            <div class="ui-block-b"><input type="button" data-theme="b" value="Update" onclick="Foosball.DOMHelper.updatePlayer($('#pagePlayerSettings_Id').val());" /></div>	   
        </fieldset>
    </div>
    <div data-role="footer" data-id="myFooter" data-position="fixed" class="ui-bar">
        <a href="#pageListGames" data-role="button" data-icon="grid">Games</a>
        <a href="#pageListPlayers" data-role="button" data-icon="grid">Players</a>
    </div>
</div>

<div id="pageGameSettings" data-role="page">
    <div data-role="header" data-position="inline">
        <h1 id="pageGameSettings_Title"></h1>
    </div>
    <div data-role="content">
        <input type="hidden" name="pageGameSettings_Id" id="pageGameSettings_Id" />
        <div data-role="fieldcontain">
            <label>Team 1:</label><br />
            <select name="pageGameSettings_t1p1" id="pageGameSettings_t1p1"><option>Karn</option><option>Jessica</option><option>More item</option></select>
            <select name="pageGameSettings_t1p2" id="pageGameSettings_t1p2"><option>Karn</option><option>Jessica</option><option>More item</option></select>
        </div>	
        <div data-role="fieldcontain">
            <label>Team 2:</label><br />
            <select name="pageGameSettings_t2p1" id="pageGameSettings_t2p1"><option>Karn</option><option>Jessica</option><option>More item</option></select>
            <select name="pageGameSettings_t2p2" id="pageGameSettings_t2p2"><option>Karn</option><option>Jessica</option><option>More item</option></select>
        </div>
        <fieldset class="ui-grid-a">
            <div class="ui-block-a"><input type="button" value="Cancel" onclick="$.mobile.changePage('#pageListGames');" /></div>
            <div class="ui-block-b"><input type="button" data-theme="b" value="Update" onclick="Foosball.DOMHelper.updateGame($('#pageGameSettings_Id').val());" /></div>	   
        </fieldset>
    </div>
    <div data-role="footer" data-id="myFooter" data-position="fixed" class="ui-bar">
        <a href="#pageListGames" data-role="button" data-icon="grid">Games</a>
        <a href="#pageListPlayers" data-role="button" data-icon="grid">Players</a>
    </div>
</div>




</body>
<script language="javascript" type="text/javascript">
// __TODO__ 
// Right now we're adding a new page for each Player/Game Settings page.
// Might be better if we have one page, and just reload the values each
// time we go to it.  That way we don't clutter up the DOM.

var Foosball = Foosball || {};

Foosball.DOMHelper = function () { }
Foosball.DOMHelper.initialize = function (name) { 
    // initialize
}
Foosball.DOMHelper.addPlayer = function () {
    var newId = system.addPlayer();
    system.gotoPagePlayerSettings(newId);
}
Foosball.DOMHelper.addGame = function () {
    var newId = system.addGame();
    system.gotoPageGameSettings(newId);
}
Foosball.DOMHelper.updatePlayer = function (id) {
    system.updatePlayer(id, $('#pagePlayerSettings_Name').val());
    $.mobile.changePage("#pageListPlayers");
}
Foosball.DOMHelper.updateGame = function (id) {
    alert("__TODO__ add Foosball.DOMHelper.updateGame()");
}


Foosball.System = function () {
    this.__namespace = "Foosball";
    this.__name = "System";
    this.Players = new Array();
    this.Games = new Array();
}
Foosball.System.prototype.resumeState = function () {
    // we can only save data as JSON (e.g. can't save functions)
    // so when we restore it, we have to set the data to an instance of Foosball.System
    // in this case: self
    var data = JSON.parse(localStorage.getItem(this.__namespace + "-" + this.__name));
    this.Players = data != null ? data.Players : new Array();
    this.Games = data != null ? data.Games : new Array();
    
    this.refreshPlayerList(); 
    this.refreshGameList(); 
}
Foosball.System.prototype.saveState = function () {
    localStorage.setItem(this.__namespace + "-" + this.__name, JSON.stringify(this));
}
Foosball.System.prototype.refreshPlayerList = function () {
    $("#playerList").html('');
    for(var ii in this.Players) {
        $("#playerList").append(
            "<li><a href='#'" +
            " onclick='system.gotoPagePlayerSettings("+ this.Players[ii].Id +"); return false;'>"+ 
            this.Players[ii].Id +": "+ this.Players[ii].Name +"</a></li>"
        );
    }
    try { 
        $("#playerList").listview('refresh'); 
    } catch (error) { }
}
Foosball.System.prototype.refreshGameList = function () {
    $("#gameList").html('');
    for (var ii in this.Games) {

        var t1p1 = t1p2 = t2p1 = t2p2 = "??";
        try { t1p1 = this.Players[this.Games[ii].Team1.Player1].Name; } catch (error) { }
        try { t1p2 = this.Players[this.Games[ii].Team1.Player2].Name; } catch (error) { }
        try { t2p1 = this.Players[this.Games[ii].Team2.Player1].Name; } catch (error) { }
        try { t2p2 = this.Players[this.Games[ii].Team2.Player2].Name; } catch (error) { }

        var t1 = (t1p1 == t1p2 ? t1p1 : t1p1 + " / " + t1p2);
        var t2 = (t2p1 == t2p2 ? t2p1 : t2p1 + " / " + t2p2);

        $("#gameList").append(
            "<li><a href='#'" +
                " onclick='system.gotoPageGameSettings(" + this.Games[ii].Id + "); return false;'>" +
                this.Games[ii].Id + ": " +
                t1 + " vs " + t2 +
            "</a></li>"
        );
    }
    try {
        $("#gameList").listview('refresh');
    } catch (error) { }
}
Foosball.System.prototype.gotoPagePlayerSettings = function (id) {
    $("#pagePlayerSettings_Title").html("Player #" + this.Players[id].Id);

    $("#pagePlayerSettings_Id").val(this.Players[id].Id);
    $("#pagePlayerSettings_Name").val(this.Players[id].Name);

    $.mobile.changePage("#pagePlayerSettings", "fade", false, true);
}
Foosball.System.prototype.gotoPageGameSettings = function (id) {
    $("#pageGameSettings_Title").html("Game #" + this.Players[id].Id);

    $("#pageGameSettings_Id").val(this.Players[id].Id);

    $.mobile.changePage("#pageGameSettings", "fade", false, true);
}
Foosball.System.prototype.addPlayer = function () {
    var newId = this.Players.length;
    var newItem = new Foosball.Player();
    newItem.Id = newId;
    newItem.Name = "New Player";
    
    this.Players[newId] = newItem;
    this.saveState();
    this.refreshPlayerList();
    
    return newId;
}
Foosball.System.prototype.addGame = function () {
    // add a game to the history
    var newId = this.Games.length;
    var newItem = new Foosball.Game();
    newItem.Id = newId;
    newItem.Team1 = new Foosball.Team();
    newItem.Team2 = new Foosball.Team();
    newItem.StartDate = new Date();
    
    this.Games[newId] = newItem;
    this.saveState();
    this.refreshGameList();
    
    return newId;
}
Foosball.System.prototype.updatePlayer = function (id, name) {
    this.Players[id].Name = name;
    this.saveState();
    this.refreshPlayerList();
}
Foosball.System.prototype.updateGame = function (id, name) {
    alert("__TODO__ add Foosball.System.prototype.updateGame()");
}

Foosball.Player = function () {
    this.Id = 0;
    this.Name = "";
}
Foosball.Game = function () {
    this.Id = 0;
    this.Name = "";
    this.Team1 = null;
    this.Team2 = null;
    this.Points = new Array();
    this.StartDate = null;
    this.EndDate = null;
}
Foosball.Team = function () {
    this.Id = 0;
    this.Player1 = null;
    this.Player2 = null;
}
Foosball.Point = function () {
    this.Id = 0;
    this.Team = null;
    this.Player = null;
    this.Timestamp = null;
}









// jquery mobile settings 
$(document).bind("mobileinit", function(){
    $.mobile.defaultPageTransition = "fade";
});


// start up code
var foosball;
$(document).ready(function() {
    system = new Foosball.System();
    system.resumeState();
    
});
</script>
</html>